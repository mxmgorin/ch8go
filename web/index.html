<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>CHIP-8 WASM</title>

        <style>
            #chip8-canvas {
                image-rendering: optimizeSpeed;
                image-rendering: -moz-crisp-edges;
                image-rendering: -webkit-optimize-contrast;
                image-rendering: pixelated;
                image-rendering: crisp-edges;
            }
        </style>
    </head>

    <body>
        <canvas id="chip8-canvas"></canvas>

        <br />
        <input type="file" id="romInput" accept=".ch8" />

        <script src="wasm_exec.js"></script>

        <script>
            const go = new Go();

            async function init() {
                const resp = await fetch("main.wasm");
                const bytes = await resp.arrayBuffer();
                const result = await WebAssembly.instantiate(
                    bytes,
                    go.importObject,
                );

                go.run(result.instance);

                // ROM loader â†’ Go function
                document.getElementById("romInput").onchange = async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    const data = new Uint8Array(await file.arrayBuffer());
                    chip8_loadROM(data);
                };
            }

            init();
        </script>
    </body>
</html>
